// Alternative 2: Build-time script to generate a registry file
// Run this script before building: npm run generate-registry
// This generates a registry.ts file with explicit imports

import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Find all block directories
const blocksDir = path.resolve(__dirname, "../../sano/page-builder/blocks");
const blocks = fs.readdirSync(blocksDir, { withFileTypes: true })
   .filter(dirent => dirent.isDirectory())
   .map(dirent => dirent.name);

// Generate registry file
const imports = blocks.map(block => {
   const blockPath = `../../page-builder/blocks/${block}/${block}.vue`;
   return `import ${block}Component from "${blockPath}";`;
}).join("\n");

const exports = blocks.map(block => {
   return `   "${block}": ${block}Component,`;
}).join("\n");

const registryContent = `// Auto-generated block registry
// Run: npm run generate-registry to regenerate

${imports}

export const blockModules = {
${exports}
};

export const blockTypes = ${JSON.stringify(blocks, null, 2)};
`;

fs.writeFileSync(
   path.resolve(__dirname, "../src/components/PageRenderer/blockRegistry.generated.ts"),
   registryContent
);

console.log(`Generated registry with ${blocks.length} blocks`);

